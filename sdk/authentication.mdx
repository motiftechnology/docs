---
title: "SDK Authentication"
description: "Authentication flow for the ChaterAfrika SDK"
---

## Overview

The ChaterAfrika SDK uses token-based authentication. You need an SDK token to connect to the WebSocket server.

## Token Types

| Token | Lifetime | Usage |
|-------|----------|-------|
| Access Token | 15 min | REST API requests |
| Refresh Token | 7 days | Refresh access token |
| SDK Token | 15 min | WebSocket connection |

## Authentication Flow

```
1. User logs in → Get access + refresh tokens
2. Exchange access token → Get SDK token
3. Initialize SDK with SDK token
4. Connect to WebSocket
```

## Getting an SDK Token

### Step 1: Login

```bash
curl -X POST https://api.chaterafrika.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'
```

Response:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "user-uuid",
    "email": "user@example.com",
    "first_name": "John",
    "last_name": "Doe"
  }
}
```

### Step 2: Get SDK Token

```bash
curl -X POST https://api.chaterafrika.com/api/v1/auth/sdk-token \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "app_id": "your-app-id"
  }'
```

Response:
```json
{
  "sdk_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### Step 3: Initialize SDK

```typescript
import { ChatAfrika } from '@chatafrika/sdk';

const client = new ChatAfrika({
  wsUrl: 'wss://ws.dev.chaterafrika.com',
  token: sdkToken
});

await client.connect();
```

## Token Refresh

SDK tokens expire after 15 minutes. Handle token expiration:

### Detecting Token Expiration

```typescript
client.on('error', (error) => {
  if (error.message.includes('Token expired')) {
    // Token expired, need to refresh
    handleTokenExpired();
  }
});

async function handleTokenExpired() {
  // Get new SDK token from your backend
  const newToken = await fetchNewSdkToken();
  
  // Update the SDK token
  client.updateToken(newToken);
  
  // Reconnect
  await client.connect();
}
```

### Automatic Token Management

```typescript
class TokenManager {
  private refreshTimer: NodeJS.Timeout | null = null;
  
  constructor(
    private client: ChatAfrika,
    private refreshCallback: () => Promise<string>
  ) {
    // Refresh token 1 minute before expiry (14 minutes)
    this.scheduleRefresh(14 * 60 * 1000);
  }
  
  private scheduleRefresh(delay: number) {
    this.refreshTimer = setTimeout(async () => {
      try {
        const newToken = await this.refreshCallback();
        this.client.updateToken(newToken);
        await this.client.connect();
        
        // Schedule next refresh
        this.scheduleRefresh(14 * 60 * 1000);
      } catch (error) {
        console.error('Token refresh failed:', error);
      }
    }, delay);
  }
  
  stop() {
    if (this.refreshTimer) {
      clearTimeout(this.refreshTimer);
    }
  }
}

// Usage
const tokenManager = new TokenManager(client, async () => {
  const response = await fetch('/api/refresh-sdk-token');
  const { sdk_token } = await response.json();
  return sdk_token;
});
```

## Token Claims

The SDK token contains the following claims:

```json
{
  "sub": "user-uuid",
  "tenant_id": "tenant-uuid",
  "app_id": "app-uuid",
  "type": "sdk",
  "exp": 1234567890,
  "iat": 1234567890
}
```

## Security Best Practices

<CardGroup cols={2}>
  <Card title="Never expose tokens" icon="eye-slash">
    Never log or expose SDK tokens in client-side code.
  </Card>
  <Card title="Use HTTPS" icon="lock">
    Always use secure connections (wss://, https://).
  </Card>
  <Card title="Short token lifetime" icon="clock">
    SDK tokens are intentionally short-lived (15 min) for security.
  </Card>
  <Card title="Backend token exchange" icon="server">
    Exchange tokens server-side, not in client code.
  </Card>
</CardGroup>

## Backend Token Exchange Pattern

Recommended pattern for production:

```typescript
// Your backend API
app.post('/api/sdk-token', async (req, res) => {
  // Verify user session
  const user = await verifySession(req);
  
  // Get SDK token from ChaterAfrika
  const response = await fetch('https://api.chaterafrika.com/api/v1/auth/sdk-token', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.CHATERAFRIKA_ACCESS_TOKEN}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      app_id: process.env.CHATERAFRIKA_APP_ID
    })
  });
  
  const { sdk_token } = await response.json();
  res.json({ sdk_token });
});

// Frontend
async function getSdkToken() {
  const response = await fetch('/api/sdk-token', {
    credentials: 'include' // Include session cookie
  });
  const { sdk_token } = await response.json();
  return sdk_token;
}

const token = await getSdkToken();
const client = new ChatAfrika({
  wsUrl: 'wss://ws.dev.chaterafrika.com',
  token
});
```

## Complete Example

```typescript
import { ChatAfrika } from '@chatafrika/sdk';

class ChatService {
  private client: ChatAfrika | null = null;
  
  async initialize() {
    // Get SDK token from your backend
    const token = await this.fetchSdkToken();
    
    // Initialize client
    this.client = new ChatAfrika({
      wsUrl: 'wss://ws.dev.chaterafrika.com',
      token,
      debug: true
    });
    
    // Handle token expiration
    this.client.on('error', async (error) => {
      if (error.message.includes('Token expired')) {
        await this.refreshAndReconnect();
      }
    });
    
    // Connect
    await this.client.connect();
    
    return this.client;
  }
  
  private async fetchSdkToken(): Promise<string> {
    const response = await fetch('/api/sdk-token', {
      credentials: 'include'
    });
    const { sdk_token } = await response.json();
    return sdk_token;
  }
  
  private async refreshAndReconnect() {
    if (!this.client) return;
    
    const newToken = await this.fetchSdkToken();
    this.client.updateToken(newToken);
    await this.client.connect();
  }
  
  async disconnect() {
    if (this.client) {
      await this.client.disconnect();
      this.client = null;
    }
  }
}

// Usage
const chatService = new ChatService();
const client = await chatService.initialize();
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Conversations" icon="comments" href="/sdk/conversations">
    Join and manage conversations
  </Card>
  <Card title="Messaging" icon="message" href="/sdk/messaging">
    Send and receive messages
  </Card>
  <Card title="WebSocket Auth" icon="plug" href="/websocket/authentication">
    WebSocket authentication details
  </Card>
  <Card title="API Auth" icon="key" href="/guides/authentication">
    REST API authentication
  </Card>
</CardGroup>
